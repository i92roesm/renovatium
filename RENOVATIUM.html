<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Auto-Refrescador de URL</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            margin: 0;
            padding: 20px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .container {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(15px);
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 8px 32px rgba(31, 38, 135, 0.37);
            border: 1px solid rgba(255, 255, 255, 0.18);
            max-width: 650px;
            width: 100%;
            text-align: center;
        }

        h1 {
            margin-bottom: 30px;
            font-size: 2.5em;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .input-section {
            margin-bottom: 30px;
        }

        input[type="url"], input[type="number"] {
            width: 100%;
            max-width: 400px;
            padding: 15px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            background: rgba(255, 255, 255, 0.9);
            color: #333;
            margin-bottom: 20px;
            box-sizing: border-box;
        }

        input:focus {
            outline: none;
            box-shadow: 0 0 20px rgba(255, 255, 255, 0.3);
        }

        .input-group {
            display: flex;
            gap: 15px;
            align-items: center;
            justify-content: center;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }

        .input-group input {
            max-width: 150px;
            margin-bottom: 0;
        }

        .input-group label {
            font-weight: bold;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
        }

        .presets {
            margin: 20px 0;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .preset-btn {
            background: rgba(255, 255, 255, 0.2);
            border: 2px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .preset-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-1px);
        }

        button {
            background: linear-gradient(45deg, #4CAF50, #45a049);
            border: none;
            color: white;
            padding: 15px 30px;
            margin: 10px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
        }

        button:disabled {
            background: rgba(255, 255, 255, 0.3);
            cursor: not-allowed;
            transform: none;
        }

        .stop-btn {
            background: linear-gradient(45deg, #f44336, #d32f2f);
        }

        .human-btn {
            background: linear-gradient(45deg, #ff9800, #f57c00);
            font-size: 14px;
            padding: 10px 20px;
        }

        .human-mode {
            background: rgba(255, 152, 0, 0.2);
            border: 2px solid #ff9800;
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
            display: none;
        }

        .human-mode.active {
            display: block;
        }

        .range-inputs {
            display: flex;
            gap: 15px;
            align-items: center;
            justify-content: center;
            flex-wrap: wrap;
            margin: 15px 0;
        }

        .range-inputs input {
            max-width: 100px;
            margin-bottom: 0;
        }

        .status-section {
            margin-top: 30px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            display: none;
        }

        .timer-display {
            font-size: 2.5em;
            font-weight: bold;
            margin: 20px 0;
            font-family: 'Courier New', monospace;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .progress-bar {
            width: 100%;
            height: 15px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            overflow: hidden;
            margin: 20px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4CAF50, #45a049);
            border-radius: 10px;
            transition: width 1s ease;
            width: 0%;
        }

        .progress-fill.human {
            background: linear-gradient(90deg, #ff9800, #f57c00);
        }

        .current-url {
            word-break: break-all;
            background: rgba(0,0,0,0.2);
            padding: 10px;
            border-radius: 10px;
            margin: 15px 0;
            font-family: monospace;
        }

        .info {
            font-size: 14px;
            opacity: 0.8;
            margin-top: 20px;
        }

        .hidden {
            display: none;
        }

        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #4CAF50;
            margin-right: 8px;
            animation: pulse 2s infinite;
        }

        .status-indicator.human {
            background: #ff9800;
        }

        .window-status {
            background: rgba(0,0,0,0.2);
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
        }

        .warning {
            background: rgba(255, 193, 7, 0.2);
            border: 2px solid #ffc107;
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
            font-size: 14px;
        }

        .settings-summary {
            background: rgba(0,0,0,0.2);
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
            font-weight: bold;
        }

        .human-indicator {
            background: rgba(255, 152, 0, 0.3);
            border: 2px solid #ff9800;
            padding: 10px;
            border-radius: 10px;
            margin: 10px 0;
            font-size: 14px;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîÑ Auto-Refrescador de URL</h1>
        
        <div class="input-section" id="inputSection">
            <div class="warning">
                ‚ö†Ô∏è <strong>Importante:</strong> Aseg√∫rate de permitir pop-ups en tu navegador para que funcione correctamente.
            </div>
            
            <input type="url" id="urlInput" placeholder="https://ejemplo.com" required>
            
            <div class="input-group">
                <label for="minutesInput">‚è±Ô∏è Refrescar cada:</label>
                <input type="number" id="minutesInput" min="1" max="1440" value="20" placeholder="20">
                <label>minutos</label>
            </div>
            
            <div class="presets">
                <span style="opacity: 0.8; font-size: 14px; margin-right: 10px;">Intervalos comunes:</span>
                <button type="button" class="preset-btn" onclick="setMinutes(1)">1 min</button>
                <button type="button" class="preset-btn" onclick="setMinutes(5)">5 min</button>
                <button type="button" class="preset-btn" onclick="setMinutes(10)">10 min</button>
                <button type="button" class="preset-btn" onclick="setMinutes(15)">15 min</button>
                <button type="button" class="preset-btn" onclick="setMinutes(20)">20 min</button>
                <button type="button" class="preset-btn" onclick="setMinutes(30)">30 min</button>
                <button type="button" class="preset-btn" onclick="setMinutes(60)">1 hora</button>
            </div>

            <button type="button" class="human-btn" onclick="toggleHumanMode()">
                ü§ñ‚û°Ô∏èüë§ Voy a ser m√°s humano
            </button>

            <div class="human-mode" id="humanMode">
                <h3 style="margin-top: 0;">üé≤ Modo Aleatorio (M√°s Humano)</h3>
                <p style="font-size: 14px; opacity: 0.9;">
                    El refresco ser√° aleatorio entre dos intervalos para simular comportamiento humano
                </p>
                <div class="range-inputs">
                    <label>M√≠nimo:</label>
                    <input type="number" id="minMinutes" min="1" max="1440" value="3" placeholder="3">
                    <label>minutos</label>
                    <label style="margin-left: 10px;">‚û°Ô∏è M√°ximo:</label>
                    <input type="number" id="maxMinutes" min="1" max="1440" value="20" placeholder="20">
                    <label>minutos</label>
                </div>
                <div style="font-size: 13px; opacity: 0.8; margin-top: 10px;">
                    Ejemplo: Entre 3 y 20 minutos = refrescar√° en 7 min, luego 15 min, luego 4 min, etc.
                </div>
            </div>
            
            <button onclick="startAutoRefresh()" id="startBtn">üöÄ Comenzar Auto-Refresco</button>
            
            <div class="info">
                Configura la URL y el intervalo de tiempo deseado
            </div>
        </div>

        <div class="status-section" id="statusSection">
            <h3>
                <span class="status-indicator" id="statusIndicator"></span>
                <span id="modeTitle">Auto-Refrescador Activo</span>
            </h3>
            
            <div class="settings-summary" id="settingsSummary">
                <!-- Se llenar√° din√°micamente -->
            </div>

            <div class="human-indicator hidden" id="humanIndicator">
                üé≤ Pr√≥ximo refresco en: <strong id="nextRefreshTime">--</strong> minutos (aleatorio)
            </div>
            
            <div class="current-url" id="currentUrl"></div>
            
            <div class="window-status" id="windowStatus">
                Estado de la ventana: <span id="windowStatusText">Iniciando...</span>
            </div>
            
            <div class="timer-display" id="timerDisplay">--:--</div>
            
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
            
            <button onclick="pauseAutoRefresh()" id="pauseBtn">‚è∏Ô∏è Pausar</button>
            <button onclick="resumeAutoRefresh()" id="resumeBtn" class="hidden">‚ñ∂Ô∏è Reanudar</button>
            <button onclick="stopAutoRefresh()" class="stop-btn">‚èπÔ∏è Detener</button>
            <button onclick="refreshNow()">üîÑ Refrescar Ahora</button>
            <button onclick="openNewWindow()">üÜï Abrir Nueva Ventana</button>
        </div>
    </div>

    <script>
        let refreshInterval;
        let countdownInterval;
        let statusCheckInterval;
        let timeRemaining = 1200;
        let totalTime = 1200;
        let isPaused = false;
        let currentUrl = '';
        let targetWindow = null;
        let humanMode = false;
        let minMinutes = 3;
        let maxMinutes = 20;
        let nextRandomTime = 0;

        function toggleHumanMode() {
            humanMode = !humanMode;
            const humanModeDiv = document.getElementById('humanMode');
            const regularInput = document.getElementById('minutesInput').parentElement;
            const presetsDiv = document.querySelector('.presets');
            const btn = event.target;

            if (humanMode) {
                humanModeDiv.classList.add('active');
                regularInput.style.display = 'none';
                presetsDiv.style.display = 'none';
                btn.textContent = '‚è±Ô∏è Volver a modo normal';
                btn.style.background = 'linear-gradient(45deg, #4CAF50, #45a049)';
            } else {
                humanModeDiv.classList.remove('active');
                regularInput.style.display = 'flex';
                presetsDiv.style.display = 'flex';
                btn.textContent = 'ü§ñ‚û°Ô∏èüë§ Voy a ser m√°s humano';
                btn.style.background = 'linear-gradient(45deg, #ff9800, #f57c00)';
            }
        }

        function setMinutes(minutes) {
            document.getElementById('minutesInput').value = minutes;
        }

        function getRandomMinutes(min, max) {
            return Math.floor(Math.random() * (max - min + 1)) + min;
        }

        function startAutoRefresh() {
            const urlInput = document.getElementById('urlInput');
            const url = urlInput.value.trim();
            
            // Validar URL
            if (!url) {
                alert('Por favor, ingresa una URL v√°lida');
                return;
            }
            
            try {
                new URL(url);
            } catch (e) {
                alert('Por favor, ingresa una URL v√°lida (debe incluir http:// o https://)');
                return;
            }
            
            // Validar seg√∫n el modo
            if (humanMode) {
                const minInput = parseInt(document.getElementById('minMinutes').value);
                const maxInput = parseInt(document.getElementById('maxMinutes').value);
                
                if (!minInput || !maxInput || minInput < 1 || maxInput < 1) {
                    alert('Por favor, ingresa valores v√°lidos para el intervalo aleatorio (m√≠nimo 1 minuto)');
                    return;
                }
                
                if (minInput >= maxInput) {
                    alert('‚ùå Error: El valor m√≠nimo debe ser menor que el valor m√°ximo\n\nEjemplo: M√≠nimo 3 min, M√°ximo 20 min');
                    return;
                }
                
                minMinutes = minInput;
                maxMinutes = maxInput;
                nextRandomTime = getRandomMinutes(minMinutes, maxMinutes);
                totalTime = nextRandomTime * 60;
                timeRemaining = totalTime;
            } else {
                const minutes = parseInt(document.getElementById('minutesInput').value);
                
                if (!minutes || minutes < 1 || minutes > 1440) {
                    alert('Por favor, ingresa un n√∫mero v√°lido de minutos (entre 1 y 1440)');
                    return;
                }
                
                totalTime = minutes * 60;
                timeRemaining = totalTime;
            }
            
            // Configurar variables globales
            currentUrl = url;
            
            // Abrir la ventana
            if (!openNewWindow()) {
                return;
            }
            
            // Mostrar secci√≥n de estado
            document.getElementById('inputSection').style.display = 'none';
            document.getElementById('statusSection').style.display = 'block';
            document.getElementById('currentUrl').textContent = url;
            
            // Configurar UI seg√∫n el modo
            const statusIndicator = document.getElementById('statusIndicator');
            const progressFill = document.getElementById('progressFill');
            const modeTitle = document.getElementById('modeTitle');
            const humanIndicator = document.getElementById('humanIndicator');
            
            if (humanMode) {
                statusIndicator.classList.add('human');
                progressFill.classList.add('human');
                modeTitle.textContent = 'Modo Humano Activo üë§';
                humanIndicator.classList.remove('hidden');
                document.getElementById('nextRefreshTime').textContent = nextRandomTime;
            } else {
                statusIndicator.classList.remove('human');
                progressFill.classList.remove('human');
                modeTitle.textContent = 'Auto-Refrescador Activo';
                humanIndicator.classList.add('hidden');
            }
            
            // Mostrar resumen de configuraci√≥n
            const settingsSummary = document.getElementById('settingsSummary');
            if (humanMode) {
                settingsSummary.innerHTML = `
                    üìä <strong>Configuraci√≥n (Modo Humano):</strong><br>
                    üé≤ Intervalo Aleatorio: ${minMinutes} - ${maxMinutes} minutos<br>
                    üîÑ Pr√≥ximo refresco: ${nextRandomTime} minutos<br>
                    üåê URL: ${url.length > 50 ? url.substring(0, 50) + '...' : url}
                `;
            } else {
                const minutes = Math.floor(totalTime / 60);
                settingsSummary.innerHTML = `
                    üìä <strong>Configuraci√≥n:</strong><br>
                    üîÑ Intervalo: ${minutes} minuto${minutes > 1 ? 's' : ''}<br>
                    üåê URL: ${url.length > 50 ? url.substring(0, 50) + '...' : url}
                `;
            }
            
            // Iniciar el auto-refresco
            startTimer();
            startStatusCheck();
        }
        
        function openNewWindow() {
            console.log('Abriendo ventana para:', currentUrl);
            
            if (targetWindow && !targetWindow.closed) {
                try {
                    targetWindow.close();
                } catch (e) {
                    console.log('No se pudo cerrar ventana anterior');
                }
            }
            
            targetWindow = window.open(currentUrl, 'autoRefreshWindow_' + Date.now(), 'width=1024,height=768,scrollbars=yes,resizable=yes,location=yes,menubar=yes,toolbar=yes');
            
            if (!targetWindow) {
                alert('‚ùå No se pudo abrir la ventana. Por favor:\n\n1. Permite pop-ups en tu navegador\n2. Int√©ntalo de nuevo');
                updateWindowStatus('Error: Pop-ups bloqueados ‚ùå');
                return false;
            }
            
            updateWindowStatus('Ventana abierta correctamente ‚úÖ');
            return true;
        }
        
        function startTimer() {
            if (refreshInterval) clearInterval(refreshInterval);
            if (countdownInterval) clearInterval(countdownInterval);
            
            timeRemaining = totalTime;
            isPaused = false;
            
            document.getElementById('pauseBtn').classList.remove('hidden');
            document.getElementById('resumeBtn').classList.add('hidden');
            
            refreshInterval = setInterval(() => {
                if (!isPaused) {
                    refreshNow();
                    
                    // Si estamos en modo humano, calcular nuevo tiempo aleatorio
                    if (humanMode) {
                        nextRandomTime = getRandomMinutes(minMinutes, maxMinutes);
                        totalTime = nextRandomTime * 60;
                        timeRemaining = totalTime;
                        document.getElementById('nextRefreshTime').textContent = nextRandomTime;
                        
                        // Actualizar el resumen
                        const settingsSummary = document.getElementById('settingsSummary');
                        settingsSummary.innerHTML = `
                            üìä <strong>Configuraci√≥n (Modo Humano):</strong><br>
                            üé≤ Intervalo Aleatorio: ${minMinutes} - ${maxMinutes} minutos<br>
                            üîÑ Pr√≥ximo refresco: ${nextRandomTime} minutos<br>
                            üåê URL: ${currentUrl.length > 50 ? currentUrl.substring(0, 50) + '...' : currentUrl}
                        `;
                    }
                }
            }, totalTime * 1000);
            
            countdownInterval = setInterval(() => {
                if (!isPaused) {
                    if (timeRemaining > 0) {
                        timeRemaining--;
                    } else {
                        timeRemaining = totalTime;
                    }
                    updateDisplay();
                }
            }, 1000);
            
            updateDisplay();
        }
        
        function startStatusCheck() {
            if (statusCheckInterval) clearInterval(statusCheckInterval);
            
            statusCheckInterval = setInterval(() => {
                if (targetWindow) {
                    try {
                        if (targetWindow.closed) {
                            updateWindowStatus('Ventana cerrada ‚ö†Ô∏è');
                        } else {
                            updateWindowStatus('Ventana activa ‚úÖ');
                        }
                    } catch (error) {
                        updateWindowStatus('Estado de ventana desconocido ‚ö†Ô∏è');
                    }
                } else {
                    updateWindowStatus('No hay ventana activa ‚ùå');
                }
            }, 3000);
        }
        
        function updateDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            const displayTime = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            
            const timerElement = document.getElementById('timerDisplay');
            if (timerElement) {
                timerElement.textContent = displayTime;
            }
            
            const progress = ((totalTime - timeRemaining) / totalTime) * 100;
            const progressElement = document.getElementById('progressFill');
            if (progressElement) {
                progressElement.style.width = `${progress}%`;
            }
        }
        
        function updateWindowStatus(status) {
            document.getElementById('windowStatusText').textContent = status;
        }
        
        function pauseAutoRefresh() {
            isPaused = true;
            document.getElementById('pauseBtn').classList.add('hidden');
            document.getElementById('resumeBtn').classList.remove('hidden');
        }
        
        function resumeAutoRefresh() {
            isPaused = false;
            document.getElementById('pauseBtn').classList.remove('hidden');
            document.getElementById('resumeBtn').classList.add('hidden');
        }
        
        function refreshNow() {
            console.log('Intentando refrescar...', targetWindow);
            
            if (targetWindow) {
                try {
                    if (targetWindow.closed) {
                        updateWindowStatus('Ventana cerrada - Abriendo nueva... üîÑ');
                        if (openNewWindow()) {
                            setTimeout(() => {
                                if (targetWindow && !targetWindow.closed) {
                                    targetWindow.location.reload();
                                }
                            }, 1000);
                        }
                        return;
                    }
                    
                    targetWindow.location.reload();
                    timeRemaining = totalTime;
                    updateDisplay();
                    updateWindowStatus('P√°gina refrescada manualmente ‚úÖ');
                    
                } catch (error) {
                    console.log('Error al refrescar:', error);
                    try {
                        targetWindow.location.href = currentUrl + '?t=' + Date.now();
                        timeRemaining = totalTime;
                        updateDisplay();
                        updateWindowStatus('P√°gina recargada (m√©todo alternativo) ‚úÖ');
                    } catch (error2) {
                        console.log('Error secundario:', error2);
                        updateWindowStatus('Error al refrescar - Abriendo nueva ventana... üîÑ');
                        openNewWindow();
                    }
                }
            } else {
                updateWindowStatus('Abriendo nueva ventana... üîÑ');
                if (openNewWindow()) {
                    updateWindowStatus('Nueva ventana abierta ‚úÖ');
                } else {
                    updateWindowStatus('Error: No se pudo abrir ventana ‚ùå');
                }
            }
        }
        
        function stopAutoRefresh() {
            if (refreshInterval) clearInterval(refreshInterval);
            if (countdownInterval) clearInterval(countdownInterval);
            if (statusCheckInterval) clearInterval(statusCheckInterval);
            
            if (targetWindow && !targetWindow.closed) {
                targetWindow.close();
            }
            
            document.getElementById('inputSection').style.display = 'block';
            document.getElementById('statusSection').style.display = 'none';
            
            timeRemaining = totalTime;
            isPaused = false;
            targetWindow = null;
        }
    </script>
</body>
</html>